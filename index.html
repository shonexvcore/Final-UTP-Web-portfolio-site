<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNDER THE PARK | Creative Studio</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,600;1,400&family=Manrope:wght@300;400;600&family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/Flip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollToPlugin.min.js"></script>
    <script src="https://unpkg.com/lenis@1.0.45/dist/lenis.min.js"></script>

    <!-- 3D & AI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>

    <style>
        :root {
            --bg: #050505;
            --text: #e0e0e0;
            --accent: #64ffb4;
            --font-title: 'Syncopate', sans-serif;
            --font-serif: 'Cormorant Garamond', serif;
            --font-body: 'Manrope', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        @media (pointer: coarse) { * { cursor: auto !important; } }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-body);
            overflow-x: hidden;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        body.ready { height: auto; overflow-y: auto; overflow-x: hidden; }

        /* Transition Curtain */
        #page-transition {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 99999; pointer-events: none; opacity: 0;
            transition: opacity 0.5s ease;
        }

        /* 3D Background */
        #canvas-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; opacity: 0; transition: opacity 2s ease;
        }
        body.ready #canvas-background { opacity: 0.8; }

        /* Camera Feed */
        #input_video {
            position: absolute; bottom: 0; left: 0; width: 1px; height: 1px;
            opacity: 0; pointer-events: none; z-index: -10; visibility: hidden;
        }

        /* Loader */
        #loader {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .brain-loader-container { position: relative; width: 200px; height: 200px; transform-style: preserve-3d; perspective: 1000px; margin-bottom: 2rem; }
        .brain-ring { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 1px solid rgba(100, 255, 180, 0.8); border-radius: 50%; box-shadow: 0 0 15px rgba(100, 255, 180, 0.3); opacity: 0.9; }
        .brain-ring:nth-child(1) { width: 100px; height: 140px; animation: brainSpin 4s linear infinite; border-style: solid; }
        .brain-ring:nth-child(2) { width: 110px; height: 130px; animation: brainSpin 6s linear infinite reverse; transform: translate(-50%, -50%) rotateY(45deg); }
        .brain-ring:nth-child(3) { width: 90px; height: 150px; animation: brainSpin 5s linear infinite; transform: translate(-50%, -50%) rotateY(90deg); border-color: rgba(255,255,255,0.5); }
        .brain-ring:nth-child(4) { width: 120px; height: 110px; animation: brainSpin 7s linear infinite reverse; transform: translate(-50%, -50%) rotateX(60deg); }
        @keyframes brainSpin { 0% { transform: translate(-50%, -50%) rotate3d(1, 1, 1, 0deg); } 100% { transform: translate(-50%, -50%) rotate3d(1, 1, 1, 360deg); } }
        .loader-count { font-family: var(--font-title); font-size: 3rem; color: #fff; line-height: 1; margin-top: 20px; }

        /* UI Elements */
        .mode-switch-container { position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem; }
        .mode-label { font-family: var(--font-title); font-size: 0.7rem; letter-spacing: 0.1em; color: #666; transition: color 0.3s; }
        .mode-switch { width: 50px; height: 26px; border: 1px solid rgba(255,255,255,0.3); border-radius: 13px; position: relative; cursor: pointer; transition: border-color 0.3s; }
        .mode-knob { width: 18px; height: 18px; background: #fff; border-radius: 50%; position: absolute; top: 3px; left: 3px; transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1), background-color 0.3s; }
        .mode-switch.active { border-color: var(--accent); }
        .mode-switch.active .mode-knob { transform: translateX(24px); background-color: var(--accent); }
        .mode-switch.active + .mode-label { color: var(--accent); }
        .toast-msg { position: fixed; bottom: 5rem; right: 2rem; background: rgba(10, 10, 10, 0.8); border-left: 2px solid var(--accent); padding: 1rem 1.5rem; font-family: var(--font-title); font-size: 0.7rem; letter-spacing: 0.05em; color: #fff; backdrop-filter: blur(5px); transform: translateX(120%); transition: transform 0.5s ease; z-index: 999; max-width: 250px; line-height: 1.5; }
        .toast-msg.show { transform: translateX(0); }

        /* Cursor */
        #cursor { 
            position: fixed; top: 0; left: 0; width: 20px; height: 20px; 
            border: 1px solid rgba(255,255,255,0.8); border-radius: 50%; 
            pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); 
            mix-blend-mode: difference; transition: width 0.3s, height 0.3s, background-color 0.3s; 
        }
        #cursor.hovered { width: 50px; height: 50px; background-color: rgba(255,255,255,0.1); border-color: transparent; backdrop-filter: blur(2px); }
        @media (pointer: coarse) { #cursor { display: none !important; } }

        /* Header */
        .site-header { position: fixed; top: 0; left: 0; width: 100%; padding: 2.5rem 4rem; z-index: 100; display: flex; align-items: center; justify-content: space-between; pointer-events: none; mix-blend-mode: exclusion; }
        .header-left { pointer-events: auto; }
        .company-name { font-family: var(--font-title); font-weight: 700; font-size: 1.2rem; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; }
        .nav-trigger { pointer-events: auto; cursor: pointer; font-family: var(--font-title); font-size: 0.8rem; letter-spacing: 0.2em; display: flex; gap: 2rem; }
        .nav-item { transition: color 0.3s; }
        .nav-item:hover { color: var(--accent); }

        /* Layout */
        .wrapper { padding: 0 4rem; max-width: 1600px; margin: 0 auto; position: relative; z-index: 10; }
        .section-title { font-family: var(--font-title); font-size: 1.5rem; margin-bottom: 4rem; text-align: center; color: var(--accent); }

        /* Hero */
        .hero { height: 100vh; display: flex; flex-direction: column; justify-content: center; position: relative; padding-top: 5vh; }
        .hero-title-container { display: flex; flex-direction: column; width: 100%; }
        .hero-line {
            font-family: var(--font-title); font-size: 11vw; line-height: 0.85;
            text-transform: uppercase; mix-blend-mode: exclusion;
            opacity: 0; transform: translateY(50px);
        }
        .hl-1 { align-self: flex-start; margin-left: -0.5rem; font-weight: 400; }
        .hl-2 { align-self: center; color: var(--accent); font-weight: 700; z-index: 2; }
        .hl-3 { align-self: flex-end; font-weight: 400; -webkit-text-stroke: 1px #fff; color: transparent; }
        .hero-sub { margin-top: 4rem; font-size: 1rem; letter-spacing: 0.1em; color: #888; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #333; padding-top: 1rem; font-family: var(--font-body); opacity: 0; }

        /* Intro */
        .about-intro { padding-top: 15vh; padding-bottom: 15vh; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .intro-origin { margin-bottom: 4rem; }
        .origin-label { font-family: var(--font-title); font-size: 0.8rem; letter-spacing: 0.2em; color: var(--accent); display: block; margin-bottom: 1rem; }
        .origin-title { font-family: var(--font-title); font-size: 3vw; line-height: 1.2; text-transform: uppercase; font-weight: 700; }
        .intro-body { max-width: 800px; margin: 0 auto; }
        
        /* PC/SP Text Switching */
        .intro-text-pc, .overlay-text-jp-pc, .overlay-text-en-pc { display: block; }
        .intro-text-sp, .overlay-text-jp-sp, .overlay-text-en-sp { display: none; }
        
        .intro-jp { font-size: 1.2rem; line-height: 2.2; margin-bottom: 6rem; font-feature-settings: "palt"; letter-spacing: 0.05em; }
        .intro-en { font-family: var(--font-body); font-size: 1.1rem; line-height: 1.8; color: #aaa; font-weight: 300; }

        /* Works */
        .works-section { padding-top: 25vh; padding-bottom: 20vh; }
        .work-list { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5vw; }
        .work-item { position: relative; display: flex; flex-direction: column; cursor: pointer; transition: transform 0.5s ease; }
        .work-item:nth-child(even) { margin-top: 4vh; }
        .img-reveal { width: 100%; aspect-ratio: 16/10; overflow: hidden; position: relative; background: #0a0a0a; border-radius: 2px; }
        .img-reveal img { width: 100%; height: 120%; object-fit: cover; object-position: center; filter: brightness(1.0); transition: transform 0.8s cubic-bezier(0.19, 1, 0.22, 1), filter 0.5s ease; will-change: transform; }
        .work-item:hover .img-reveal img { transform: scale(1.1); filter: brightness(1.2); }
        .work-item:hover { z-index: 10; }
        .type-badge { position: absolute; top: 1rem; left: 1rem; background: rgba(0,0,0,0.7); color: #fff; border: 1px solid rgba(255,255,255,0.3); font-family: var(--font-title); font-size: 0.5rem; padding: 0.3rem 0.5rem; z-index: 2; backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s; }
        .work-item:hover .type-badge { opacity: 1; }
        .work-year { position: absolute; top: 1rem; right: 1rem; background: #fff; color: #000; font-family: var(--font-title); font-size: 0.7rem; padding: 0.3rem 0.8rem; opacity: 0; transition: opacity 0.4s; z-index: 2; transform: translateY(10px); }
        .work-item:hover .work-year { opacity: 1; transform: translateY(0); }
        .work-info { margin-top: 1rem; display: flex; justify-content: space-between; align-items: flex-start; opacity: 0.7; transition: opacity 0.3s; }
        .work-item:hover .work-info { opacity: 1; }
        .work-title { font-family: var(--font-title); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .work-cat { font-size: 0.7rem; color: #aaa; font-style: italic; }

        /* Workflow */
        .workflow-section { padding-top: 10vh; padding-bottom: 20vh; position: relative; z-index: 10; }
        .workflow-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem; margin-bottom: 2rem; }
        .workflow-grid-bottom { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; max-width: 75%; margin: 0 auto; }
        .workflow-item { padding: 2rem; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; transition: all 0.3s; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
        .workflow-item:hover { border-color: var(--accent); transform: translateY(-5px); }
        .wf-num { font-family: var(--font-title); color: var(--accent); font-size: 0.8rem; margin-bottom: 1rem; display: block; }
        .wf-title-jp { font-size: 1.1rem; margin-bottom: 0.8rem; font-weight: 600; color: #fff; }
        .wf-desc-en { font-family: var(--font-body); font-size: 0.9rem; color: #aaa; line-height: 1.6; }

        /* Footer */
        footer { height: 60vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 10; background: transparent; }
        .footer-link { font-family: var(--font-title); font-size: 2.5rem; font-weight: 700; text-transform: uppercase; color: #fff; letter-spacing: 0.3em; cursor: pointer; position: relative; padding: 1rem 2rem; border: 1px solid rgba(255,255,255,0.1); transition: all 0.5s ease; overflow: hidden; text-decoration: none; }
        .footer-link::before { content: ''; position: absolute; top: 0; left: 0; width: 0%; height: 100%; background: #fff; transition: width 0.5s cubic-bezier(0.19, 1, 0.22, 1); z-index: -1; }
        .footer-link:hover { color: #000; border-color: #fff; }
        .footer-link:hover::before { width: 100%; }

        /* Overlays (About / Contact) */
        /* 【修正：スクロールを可能に】 */
        .page-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 5, 0.98); z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; backdrop-filter: blur(10px); visibility: hidden; display: flex; justify-content: center; align-items: center; overflow-y: auto; }
        .page-overlay.active { opacity: 1; pointer-events: auto; visibility: visible; }
        .overlay-content { text-align: center; max-width: 900px; padding: 4rem; }
        .overlay-title { font-family: var(--font-title); font-size: 3rem; margin-bottom: 3rem; color: var(--accent); }
        .overlay-close-fixed { position: fixed; top: 2.5rem; right: 4rem; font-family: var(--font-title); font-size: 0.9rem; letter-spacing: 0.2em; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); padding: 1rem 2rem; transition: all 0.3s; z-index: 2100; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); opacity: 0; pointer-events: none; }
        .page-overlay.active ~ .overlay-close-fixed, .page-overlay.active .overlay-close-fixed { opacity: 1; pointer-events: auto; }
        .overlay-close-fixed:hover { background: #fff; color: #000; }
        
        .overlay-text-jp-pc { 
            font-family: "Yu Mincho", "YuMincho", serif; font-size: 1.1rem; line-height: 2.2; 
            margin-bottom: 6rem;
            color: #e0e0e0; font-feature-settings: "palt"; letter-spacing: 0.05em; 
        }
        
        .overlay-text-jp-sp { display: none; font-family: "Yu Mincho", "YuMincho", serif; font-size: 1rem; line-height: 2; margin-bottom: 2rem; color: #e0e0e0; }
        .overlay-text-en-pc { font-family: var(--font-body); font-weight: 300; font-size: 1rem; line-height: 1.8; color: #aaa; margin-bottom: 3rem; letter-spacing: 0.05em; }
        .overlay-text-en-sp { display: none; font-family: var(--font-body); font-weight: 300; font-size: 0.9rem; line-height: 1.6; color: #aaa; margin-bottom: 3rem; }

        @media (max-width: 1024px) { 
            .work-list { grid-template-columns: repeat(2, 1fr); } 
            .workflow-grid, .workflow-grid-bottom { grid-template-columns: 1fr; gap: 1rem; max-width: 100%; }
        }
        @media (max-width: 768px) {
            .site-header { padding: 1.5rem 1rem; flex-direction: column; gap: 1rem; } 
            .nav-trigger { width: 100%; justify-content: center; gap: 1.5rem; font-size: 0.7rem; }
            .wrapper { padding: 0 1.5rem; }
            .hero-line { font-size: 13vw; } .origin-title { font-size: 8vw; }
            
            .intro-text-pc, .overlay-text-jp-pc, .overlay-text-en-pc { display: none; }
            .intro-text-sp, .overlay-text-jp-sp, .overlay-text-en-sp { display: block; }
            
            .works-section { padding-top: 40vh; padding-bottom: 10vh; }
            .work-list { grid-template-columns: 1fr; gap: 5vh; } .work-item:nth-child(even) { margin-top: 0; }
            
            /* 【修正：横向き About スクロール対応】 */
            .page-overlay { display: block; padding-top: 120px; }
            .overlay-content { padding: 0 1.5rem 6rem 1.5rem; width: 100%; }
            .overlay-close-fixed { top: 1.5rem; right: 1.5rem; padding: 0.8rem 1.5rem; background: rgba(0,0,0,0.8); }
            
            .mode-switch-container { display: none; }
            .brain-loader-container { transform: scale(0.6); }
            
            /* 【修正：Start a Project 一行化】 */
            .footer-link { font-size: 1.1rem; padding: 0.8rem 1.5rem; white-space: nowrap; }
            
            @media (orientation: landscape) {
                .site-header { flex-direction: row; padding: 1rem 1.5rem; }
                .nav-trigger { width: auto; gap: 1.5rem; }
                .work-list { grid-template-columns: repeat(3, 1fr); gap: 2vw; }
                .hero-line { font-size: 15vh; } 
                .origin-title { font-size: 12vh; }
            }
        }
    </style>
</head>
<body>

    <!-- フラッシュ対策 -->
    <script>
        if (sessionStorage.getItem('visited')) {
            document.write('<style>#loader { display: none !important; }</style>');
        }
    </script>

    <video id="input_video" autoplay playsinline muted></video>
    <div id="canvas-background"></div>

    <div class="mode-switch-container">
        <div class="mode-switch hover-target" id="cam-switch">
            <div class="mode-knob"></div>
        </div>
        <div class="mode-label">3D INTERACTION</div>
    </div>
    
    <div class="toast-msg" id="toast-msg">
        FACE TRACKING ENABLED<br><span style="font-size: 0.6em; opacity: 0.7;">MOVE CLOSER TO ZOOM IN</span>
    </div>
    
    <div id="page-transition"></div>

    <header class="site-header">
        <div class="header-left"><div class="company-name hover-target">UNDER THE PARK</div></div>
        <nav class="nav-trigger">
            <div class="nav-item hover-target" onclick="openOverlay('about')">ABOUT</div>
            <div class="nav-item hover-target" onclick="scrollToWorkflow()">PROCESS</div>
            <div class="nav-item hover-target" onclick="openOverlay('contact')">CONTACT</div>
        </nav>
    </header>

    <div id="loader">
        <div class="brain-loader-container">
            <div class="brain-ring"></div><div class="brain-ring"></div><div class="brain-ring"></div><div class="brain-ring"></div>
        </div>
        <div class="loader-count">00</div>
    </div>

    <div id="cursor"></div>

    <main id="main">
        <section class="hero wrapper">
            <div class="hero-title-container">
                <div class="hero-line hl-1">WHERE</div>
                <div class="hero-line hl-2">VISION</div>
                <div class="hero-line hl-3">BREATHES</div>
            </div>
            <div class="hero-sub">
                <span>SCROLL TO EXPLORE</span>
                <span>TOKYO, JP &mdash; 2025</span>
            </div>
        </section>

        <section class="about-intro wrapper">
            <div class="intro-origin">
                <span class="origin-label">OUR ORIGIN</span>
                <h2 class="origin-title">THE "PARK" STANDS FOR<br>PERFECT QUALITY</h2>
            </div>
            <div class="intro-body">
                <p class="intro-text-pc intro-jp">
                    UNDER THE PARKの『PARK』は、PERFECT QUALITYに由来します。<br>
                    東京を拠点に、映像、写真、デザインを横断するクリエイティブ・コレクティブ。<br>
                    洗練された美学と鋭敏な感性で、見えざる本質を捉え、<br>
                    普遍的な価値を持つ『最高品質』のビジュアルへと昇華させます。
                </p>
                <p class="intro-text-pc intro-en">
                    The 'PARK' in our name stands for PERFECT QUALITY.<br>
                    Based in Tokyo, we are a creative collective traversing film, photography, and design.<br>
                    With refined aesthetics and acute sensibility, we capture the unseen essence,<br>
                    sublimating it into visual experiences of timeless value.
                </p>
                <p class="intro-text-sp intro-jp">
                    洗練された美学と鋭敏な感性で、<br>
                    見えざる本質を捉え<br>
                    普遍的な価値を持つ最高品質の<br>
                    ビジュアルへと昇華させます。
                </p>
                <p class="intro-text-sp intro-en">
                    The 'PARK' in our name stands for<br>PERFECT QUALITY.<br><br>
                    Based in Tokyo, we are a creative collective<br>
                    traversing film, photography, and design.<br><br>
                    With refined aesthetics and acute sensibility,<br>
                    we capture the unseen essence,<br>
                    sublimating it into visual experiences<br>
                    of timeless value.
                </p>
            </div>
        </section>

        <section class="works-section wrapper">
            <div class="work-list" id="work-list"></div>
        </section>

        <section class="workflow-section wrapper" id="workflow">
            <div class="section-title">WORKFLOW</div>
            <div class="workflow-grid">
                <div class="workflow-item"><span class="wf-num">01. INQUIRY</span><h3 class="wf-title-jp">お問い合わせ</h3><p class="wf-desc-en">Please contact us via email or contact form with details of your project request.</p></div>
                <div class="workflow-item"><span class="wf-num">02. HEARING</span><h3 class="wf-title-jp">ヒアリング・概算お見積り</h3><p class="wf-desc-en">We review your request and provide a rough estimate and schedule.</p></div>
                <div class="workflow-item"><span class="wf-num">03. PLANNING</span><h3 class="wf-title-jp">詳細打ち合わせ・企画構成</h3><p class="wf-desc-en">We conduct detailed meetings to finalize the creative direction and logistics.</p></div>
                <div class="workflow-item"><span class="wf-num">04. AGREEMENT</span><h3 class="wf-title-jp">アサイン・正式お見積り</h3><p class="wf-desc-en">Based on the plan, we assign the best creators and provide a formal quotation.</p></div>
            </div>
            <div class="workflow-grid-bottom">
                <div class="workflow-item"><span class="wf-num">05. PRODUCTION</span><h3 class="wf-title-jp">撮影・編集</h3><p class="wf-desc-en">Execution of shooting and high-end post-production.</p></div>
                <div class="workflow-item"><span class="wf-num">06. REVIEW</span><h3 class="wf-title-jp">納品・最終調整</h3><p class="wf-desc-en">Submission of deliverables and final adjustments based on feedback.</p></div>
                <div class="workflow-item"><span class="wf-num">07. COMPLETION</span><h3 class="wf-title-jp">プロジェクト完了</h3><p class="wf-desc-en">Project completion. We look forward to future collaborations.</p></div>
            </div>
        </section>

        <footer class="wrapper">
            <div class="footer-link hover-target" onclick="openOverlay('contact')">START A PROJECT</div>
        </footer>
    </main>

    <div id="about-overlay" class="page-overlay">
        <div class="overlay-close-fixed hover-target" onclick="closeOverlay('about')">CLOSE</div>
        <div class="overlay-content">
            <h2 class="overlay-title">ABOUT US</h2>
            <p class="overlay-text-jp-pc">
                UNDER THE PARKは、東京を拠点とするクリエイティブスタジオです。<br>
                私たちは映像、写真、デザインを通じて、見えざる本質を可視化し、<br>
                記憶に残るビジュアル体験を創出します。<br>
                洗練された技術と美学で、クライアントのビジョンを<br>
                世界水準のクリエイティブへと昇華させます。
            </p>
            <p class="overlay-text-en-pc">
                UNDER THE PARK is a creative studio based in Tokyo.<br>
                We visualize the unseen and archive memories into light.<br>
                Specializing in high-end visual production, we bridge the gap between<br>
                digital innovation and cinematic storytelling.
            </p>
            <p class="overlay-text-jp-sp">
                UNDER THE PARKは、<br>
                東京を拠点とするクリエイティブスタジオです。<br><br>
                私たちは映像、写真、デザインを通じて、<br>
                見えざる本質を可視化し、<br>
                記憶に残るビジュアル体験を創出します。<br><br>
                洗練された技術と美学で、<br>
                クライアントのビジョンを<br>
                世界水準のクリエイティブへと昇華させます。
            </p>
            <p class="overlay-text-en-sp">
                UNDER THE PARK is a creative studio<br>
                based in Tokyo.<br><br>
                We visualize the unseen<br>
                and archive memories into light.<br><br>
                Specializing in high-end visual production,<br>
                we bridge the gap between<br>
                digital innovation<br>
                and cinematic storytelling.
            </p>
        </div>
    </div>

    <div id="contact-overlay" class="page-overlay">
        <div class="overlay-close-fixed hover-target" onclick="closeOverlay('contact')">CLOSE</div>
        <div class="overlay-content">
            <h2 class="overlay-title">CONTACT</h2>
            <p class="overlay-text-en" style="font-family: var(--font-body); font-weight: 300; font-size: 1rem; line-height: 1.8; color: #aaa;">
                For project inquiries and collaborations:<br>
                <span style="color:#fff; font-size:1.5rem; font-weight: 400;">hello@underthepark.jp</span><br><br>
                TOKYO OFFICE<br>
                3-12-8 Shibuya, Tokyo 150-0002
            </p>
        </div>
    </div>

    <script>
        // Init & Config
        if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
        window.scrollTo(0, 0);

        // Core Functions
        window.openOverlay = function(id) {
            const el = document.getElementById(id + '-overlay');
            el.classList.add('active');
            gsap.to(el, { opacity: 1, duration: 0.3 });
            if(window.lenis) window.lenis.stop();
        }
        window.closeOverlay = function(id) {
            const el = document.getElementById(id + '-overlay');
            gsap.to(el, { opacity: 0, duration: 0.3, onComplete: () => {
                el.classList.remove('active');
                if(window.lenis) window.lenis.start();
            }});
        }
        window.scrollToWorkflow = function() {
            if(window.lenis) window.lenis.scrollTo('#workflow');
        }

        // --- Main Execution ---
        document.addEventListener("DOMContentLoaded", () => {
            
            // Failsafe Loader
            setTimeout(() => {
                const loader = document.getElementById('loader');
                if (loader && !loader.classList.contains('hidden')) {
                    gsap.to(loader, { yPercent: -100, duration: 1, ease: "power2.inOut" });
                    document.body.classList.add('ready');
                    gsap.set(".hero-line", { opacity: 1, y: 0 });
                    gsap.set(".hero-sub", { opacity: 1 });
                }
            }, 3000); 

            // Libraries
            gsap.registerPlugin(ScrollTrigger, Flip, ScrollToPlugin);
            window.lenis = new Lenis({ duration: 1.2, easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), smooth: true });
            function raf(time) { window.lenis.raf(time); requestAnimationFrame(raf); }
            requestAnimationFrame(raf);

            // Init 3D
            initThree();

            // Camera Switch
            const switchBtn = document.getElementById('cam-switch');
            if(switchBtn) switchBtn.addEventListener('click', () => { switchBtn.classList.toggle('active'); toggleCamera(switchBtn.classList.contains('active')); });

            // Loader Sequence
            const loader = document.getElementById('loader');
            const counter = document.querySelector('.loader-count');
            const countObj = { val: 0 };
            const hasVisited = sessionStorage.getItem('visited');
            
            if (!hasVisited) {
                const loadTl = gsap.timeline({
                    onComplete: () => {
                        loader.classList.add('hidden');
                        document.body.classList.add('ready');
                        sessionStorage.setItem('visited', 'true');
                        // 【修正：スクロール復元＋3D形状リフレッシュ】
                        const savedPos = sessionStorage.getItem('indexScrollPos');
                        if (savedPos) { 
                            window.scrollTo(0, parseInt(savedPos)); 
                            ScrollTrigger.refresh();
                            sessionStorage.removeItem('indexScrollPos'); 
                        }
                    }
                });
                loadTl.to(countObj, {
                    val: 100, duration: 2.0, ease: "expo.inOut",
                    onUpdate: () => { counter.innerText = Math.floor(countObj.val).toString().padStart(2, '0'); }
                })
                .to(".brain-loader-container", { scale: 2, opacity: 0, duration: 0.8, ease: "power2.in" }, "-=0.5")
                .to(loader, { yPercent: -100, duration: 1.0, ease: "power4.inOut" })
                .to(".hero-line", { opacity: 1, y: 0, duration: 1.5, stagger: 0.2, ease: "power4.out" }, "-=0.5")
                .to(".hero-sub", { opacity: 1, duration: 1 }, "-=1");
            } else {
                loader.style.display = 'none';
                document.body.classList.add('ready');
                document.getElementById('page-transition').style.opacity = 0;
                gsap.set(".hero-line", { opacity: 1, y: 0 });
                gsap.set(".hero-sub", { opacity: 1 });
                // 【修正：復元】
                const savedPos = sessionStorage.getItem('indexScrollPos');
                if (savedPos) { 
                    window.scrollTo(0, parseInt(savedPos)); 
                    ScrollTrigger.refresh();
                    sessionStorage.removeItem('indexScrollPos'); 
                }
            }

            gsap.from(".about-intro", {
                opacity: 0, y: 50, duration: 1.5, ease: "power3.out",
                scrollTrigger: { trigger: ".about-intro", start: "top 80%" }
            });

            // Morph Timing
            ScrollTrigger.create({ trigger: "body", start: "top top", endTrigger: ".intro-jp", end: "bottom 20%", scrub: 1, onUpdate: (self) => { morphProgress = self.progress; } });
            ScrollTrigger.create({ trigger: ".works-section", start: "bottom bottom", endTrigger: "#workflow", end: "center center", scrub: 1, onUpdate: (self) => { partnerProgress = self.progress; } });

            // Projects Data
            const projects = [
                { id: 1, type: 'video', title: 'NEON ROOTS', category: 'BRAND FILM', year: '2025', thumb: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb' },
                { id: 2, type: 'photo', title: 'SILENT CONCRETE', category: 'ARCHITECTURAL', year: '2025', thumb: 'https://images.unsplash.com/photo-1478760329108-5c3ed9d495a0' },
                { id: 3, type: 'video', title: 'LIQUID TIME', category: 'COMMERCIAL', year: '2024', thumb: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe' },
                { id: 4, type: 'photo', title: 'URBAN FOSSILS', category: 'ART DIRECTION', year: '2024', thumb: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b' },
                { id: 5, type: 'video', title: 'PROJECT 05', thumb: 'https://images.unsplash.com/photo-1492691527719-9d1e07e534b4', category: 'MV', year: '2024' },
                { id: 6, type: 'photo', title: 'PROJECT 06', thumb: 'https://images.unsplash.com/photo-1511447333015-45b65e60f6d5', category: 'STILL', year: '2024' },
                { id: 7, type: 'video', title: 'PROJECT 07', thumb: 'https://images.unsplash.com/photo-1542206395-9feb3edaa68d', category: 'CM', year: '2023' },
                { id: 8, type: 'photo', title: 'PROJECT 08', thumb: 'https://images.unsplash.com/photo-1505322022379-7c3353ee6291', category: 'ART', year: '2023' },
                { id: 9, type: 'video', title: 'PROJECT 09', thumb: 'https://images.unsplash.com/photo-1629812456605-4a044aa38fbc', category: 'MV', year: '2023' },
                { id: 10, type: 'photo', title: 'PROJECT 10', thumb: 'https://images.unsplash.com/photo-1499540633125-484965b60031', category: 'STILL', year: '2023' },
                { id: 11, type: 'video', title: 'PROJECT 11', thumb: 'https://images.unsplash.com/photo-1504609773096-104ff2c73ba4', category: 'CM', year: '2022' },
                { id: 12, type: 'video', title: 'PROJECT 12', thumb: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb', category: 'FILM', year: '2022' }
            ];

            const workList = document.querySelector('.work-list');
            projects.forEach((proj, i) => {
                const item = document.createElement('div');
                item.className = 'work-item hover-target';
                item.innerHTML = `<div class="img-reveal"><span class="type-badge">${proj.type}</span><span class="work-year">${proj.year}</span><img src="${proj.thumb}?q=80&w=600" loading="lazy"></div><div class="work-info"><h2 class="work-title">${proj.title}</h2><span class="work-cat">${proj.category}</span></div>`;
                
                item.addEventListener('click', () => {
                    sessionStorage.setItem('indexScrollPos', window.scrollY);
                    const curtain = document.getElementById('page-transition');
                    curtain.style.opacity = '1';
                    setTimeout(() => window.location.href = `detail.html?id=${proj.id}`, 510);
                });
                item.addEventListener('mouseenter', () => document.getElementById('cursor').classList.add('hovered'));
                item.addEventListener('mouseleave', () => document.getElementById('cursor').classList.remove('hovered'));
                workList.appendChild(item);
                
                gsap.from(item, { y: 100, opacity: 0, duration: 1.5, ease: "power4.out", scrollTrigger: { trigger: item, start: "top 90%" } });
            });

            // Cursor Logic
            const cursor = document.getElementById('cursor');
            window.addEventListener('mousemove', (e) => { gsap.to(cursor, {x: e.clientX, y: e.clientY, duration: 0.1}); });
            document.addEventListener('mouseover', (e) => { if(e.target.closest('.hover-target')) cursor.classList.add('hovered'); else cursor.classList.remove('hovered'); });
        });

        // --- 3D Logic ---
        let scene, camera, renderer, points, material;
        let geometry, basePositions, textPositions, partnerPositions; 
        let morphProgress = 0; let partnerProgress = 0; 
        let targetScale = 1.0; let currentScale = 1.0; let time = 0;
        const COLORS = [ new THREE.Color('#64ffb4'), new THREE.Color('#64c4ff'), new THREE.Color('#b464ff'), new THREE.Color('#ffae64') ];
        let currentColorIndex = 0;

        async function initThree() {
            const container = document.getElementById('canvas-background');
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050505, 0.02);
            
            const isMobile = window.innerWidth < 768;
            const isLandscape = window.innerWidth > window.innerHeight;
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = (isMobile && !isLandscape) ? 18 : 8;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);
            
            createParticles();
            startColorCycle();
            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function getCoordinatesFromText(text1, text2, fontSize, gap=4) {
            const canvas = document.createElement('canvas');
            const width = 2048; height = 1024;
            canvas.width = width; canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#000'; ctx.fillRect(0,0,width,height);
            ctx.fillStyle = '#fff'; 
            ctx.font = `900 ${fontSize}px sans-serif`;
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText(text1, width/2, height/2 - 120);
            if(text2) ctx.fillText(text2, width/2, height/2 + 120);
            const data = ctx.getImageData(0,0,width,height).data;
            const coords = [];
            for(let y=0; y<height; y+=gap) {
                for(let x=0; x<width; x+=gap) {
                    if(data[(y*width+x)*4] > 128) coords.push({x: (x-width/2)*0.008, y: -(y-height/2)*0.008});
                }
            }
            if(coords.length === 0) for(let i=0; i<1000; i++) coords.push({x: Math.cos(i)*3, y: Math.sin(i)*3});
            for (let i = coords.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [coords[i], coords[j]] = [coords[j], coords[i]]; }
            return coords;
        }

        function createParticles() {
            const count = 20000;
            const posArray = []; const baseArr = []; const textArr = []; const partnerArr = []; const colorArr = [];
            const initialColor = COLORS[0];
            const textCoords = getCoordinatesFromText("WORKS BY", "UNDER THE PARK", 180, 4);
            const partnerCoords = getCoordinatesFromText("PARTNERSHIP", "", 240, 4);

            for (let i = 0; i < count; i++) {
                let bx, by, bz;
                if (Math.random() > 0.4) {
                    const theta = Math.random() * Math.PI * 2; const r = 3 + Math.random() * 3;
                    bx = Math.cos(theta) * r; by = (Math.random() - 0.5) * 0.5; bz = Math.sin(theta) * r;
                } else {
                    const theta = Math.random() * Math.PI * 2; const phi = Math.acos((Math.random() * 2) - 1);
                    const r = 2.0; bx = r * Math.sin(phi) * Math.cos(theta); by = r * Math.sin(phi) * Math.sin(theta); bz = r * Math.cos(phi);
                }
                baseArr.push(bx, by, bz); posArray.push(bx, by, bz);
                const tp = textCoords[i % textCoords.length];
                textArr.push(tp.x, tp.y, (Math.random()-0.5)*0.2);
                const pp = partnerCoords[i % partnerCoords.length];
                partnerArr.push(pp.x, pp.y, (Math.random()-0.5)*0.2);
                colorArr.push(initialColor.r, initialColor.g, initialColor.b);
            }

            geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(posArray, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colorArr, 3));
            basePositions = new Float32Array(baseArr); textPositions = new Float32Array(textArr); partnerPositions = new Float32Array(partnerArr);

            const canvas = document.createElement('canvas'); canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16,16,0,16,16,16);
            grad.addColorStop(0, 'rgba(255,255,255,1)'); grad.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = grad; ctx.fillRect(0,0,32,32);
            const texture = new THREE.Texture(canvas); texture.needsUpdate = true;
            material = new THREE.PointsMaterial({ size: 0.05, vertexColors: true, blending: THREE.AdditiveBlending, depthWrite: false, transparent: true, opacity: 0.8, map: texture });
            points = new THREE.Points(geometry, material); scene.add(points);
        }

        function startColorCycle() {
            const updateColor = () => {
                const nextIndex = (currentColorIndex + 1) % COLORS.length;
                const colorObj = { r: COLORS[currentColorIndex].r, g: COLORS[currentColorIndex].g, b: COLORS[currentColorIndex].b };
                gsap.to(colorObj, {
                    r: COLORS[nextIndex].r, g: COLORS[nextIndex].g, b: COLORS[nextIndex].b, duration: 30, ease: "linear",
                    onUpdate: () => {
                        const colors = geometry.attributes.color.array;
                        for (let i = 0; i < colors.length; i += 3) { colors[i] = colorObj.r; colors[i+1] = colorObj.g; colors[i+2] = colorObj.b; }
                        geometry.attributes.color.needsUpdate = true;
                    }, onComplete: () => { currentColorIndex = nextIndex; updateColor(); }
                });
            };
            updateColor();
        }

        function onWindowResize() { 
            const isMobile = window.innerWidth < 768;
            const isLandscape = window.innerWidth > window.innerHeight;
            camera.aspect = window.innerWidth / window.innerHeight; 
            camera.updateProjectionMatrix(); 
            if (isMobile && !isLandscape) camera.position.z = 18; 
            else camera.position.z = 8;
            renderer.setSize(window.innerWidth, window.innerHeight); 
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.001;
            if (points) {
                const positions = geometry.attributes.position.array;
                for (let i = 0; i < positions.length; i += 3) {
                    const idx = i;
                    const bx = basePositions[idx], by = basePositions[idx+1], bz = basePositions[idx+2];
                    const tx = textPositions[idx], ty = textPositions[idx+1], tz = textPositions[idx+2];
                    const px = partnerPositions[idx], py = partnerPositions[idx+1], pz = partnerPositions[idx+2];
                    
                    let currentX = bx + (tx - bx) * morphProgress;
                    let currentY = by + (ty - by) * morphProgress;
                    let currentZ = bz + (tz - bz) * morphProgress;
                    
                    if(partnerProgress > 0) {
                        currentX = currentX + (px - currentX) * partnerProgress;
                        currentY = currentY + (py - currentY) * partnerProgress;
                        currentZ = currentZ + (pz - currentZ) * partnerProgress;
                    }
                    positions[idx] = currentX; positions[idx+1] = currentY; positions[idx+2] = currentZ;
                }
                geometry.attributes.position.needsUpdate = true;

                currentScale += (targetScale - currentScale) * 0.05;
                points.scale.set(currentScale, currentScale, currentScale);
                
                let lockFactor = Math.max(Math.pow(morphProgress, 2), partnerProgress);
                points.rotation.y = (time * 0.2) * (1 - lockFactor);
                points.rotation.z = (Math.sin(time * 0.5) * 0.05) * (1 - lockFactor);
            }
            renderer.render(scene, camera);
        }

        // Face Mesh
        let faceMesh, cameraUtils; let isCameraRunning = false;
        function initFaceMesh() {
            const videoElement = document.getElementById('input_video');
            faceMesh = new FaceMesh({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`});
            faceMesh.setOptions({ maxNumFaces: 1, refineLandmarks: true, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
            faceMesh.onResults((results) => {
                if (!isCameraRunning) return;
                if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                    const lm = results.multiFaceLandmarks[0];
                    const width = Math.sqrt(Math.pow(lm[454].x - lm[234].x, 2) + Math.pow(lm[454].y - lm[234].y, 2));
                    targetScale = Math.max(1.0, (width * 6)); 
                } else { targetScale = 1.0; }
            });
            cameraUtils = new Camera(videoElement, { onFrame: async () => { await faceMesh.send({image: videoElement}); }, width: 320, height: 240 });
        }
        function toggleCamera(enable) {
            const toast = document.getElementById('toast-msg');
            if (enable) {
                if (!faceMesh) initFaceMesh();
                cameraUtils.start().then(() => { isCameraRunning = true; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 5000); }).catch(err => { alert("Camera denied."); document.getElementById('cam-switch').classList.remove('active'); });
            } else {
                if (cameraUtils) {
                    const videoElement = document.getElementById('input_video'); const stream = videoElement.srcObject;
                    if(stream) stream.getTracks().forEach(track => track.stop()); videoElement.srcObject = null;
                }
                isCameraRunning = false; targetScale = 1.0; 
            }
        }
    </script>
</body>
</html>